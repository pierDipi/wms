<div id="window-settings">
    <div class="editForm-popup">
        <div id="tabstrip" class="tabstrip">
            <ul>
                <li class="k-state-active">Interface</li>
                <li>Account</li>
            </ul>
            <div>
                <h2>Edit Settings</h2>
                <table class="tableEdit">
                    <tbody><tr>
                            <th>Language</th>
                        </tr>
                        <tr>
                            <td>
                                <select id="kendo-language">
                                    <option value="en" selected="selected">English</option>
                                    <option value="it">Italiano</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>Culture</th>
                        </tr>
                        <tr>
                            <td>
                                <select id="kendo-culture">
                                    <option value="af-ZA" selected="selected">af-ZA</option>
                                    <option value="af">af</option>
                                    <option value="am-ET">am-ET</option>
                                    <option value="am">am</option>
                                    <option value="ar-AE">ar-AE</option>
                                    <option value="ar-BH">ar-BH</option>
                                    <option value="ar-DZ">ar-DZ</option>
                                    <option value="ar-EG">ar-EG</option>
                                    <option value="ar-IQ">ar-IQ</option>
                                    <option value="ar-JO">ar-JO</option>
                                    <option value="ar-KW">ar-KW</option>
                                    <option value="ar-LB">ar-LB</option>
                                    <option value="ar-LY">ar-LY</option>
                                    <option value="ar-MA">ar-MA</option>
                                    <option value="ar-OM">ar-OM</option>
                                    <option value="ar-QA">ar-QA</option>
                                    <option value="ar-SA">ar-SA</option>
                                    <option value="ar-SY">ar-SY</option>
                                    <option value="ar-TN">ar-TN</option>
                                    <option value="ar-YE">ar-YE</option>
                                    <option value="ar">ar</option>
                                    <option value="arn-CL">arn-CL</option>
                                    <option value="arn">arn</option>
                                    <option value="as-IN">as-IN</option>
                                    <option value="as">as</option>
                                    <option value="az-Cyrl-AZ">az-Cyrl-AZ</option>
                                    <option value="az-Cyrl">az-Cyrl</option>
                                    <option value="az-Latn-AZ">az-Latn-AZ</option>
                                    <option value="az-Latn">az-Latn</option>
                                    <option value="az">az</option>
                                    <option value="ba-RU">ba-RU</option>
                                    <option value="ba">ba</option>
                                    <option value="be-BY">be-BY</option>
                                    <option value="be">be</option>
                                    <option value="bg-BG">bg-BG</option>
                                    <option value="bg">bg</option>
                                    <option value="bn-BD">bn-BD</option>
                                    <option value="bn-IN">bn-IN</option>
                                    <option value="bn">bn</option>
                                    <option value="bo-CN">bo-CN</option>
                                    <option value="bo">bo</option>
                                    <option value="br-FR">br-FR</option>
                                    <option value="br">br</option>
                                    <option value="bs-Cyrl-BA">bs-Cyrl-BA</option>
                                    <option value="bs-Cyrl">bs-Cyrl</option>
                                    <option value="bs-Latn-BA">bs-Latn-BA</option>
                                    <option value="bs-Latn">bs-Latn</option>
                                    <option value="bs">bs</option>
                                    <option value="ca-ES-valencia">ca-ES-valencia</option>
                                    <option value="ca-ES">ca-ES</option>
                                    <option value="ca">ca</option>
                                    <option value="chr-Cher-US">chr-Cher-US</option>
                                    <option value="chr-Cher">chr-Cher</option>
                                    <option value="chr">chr</option>
                                    <option value="co-FR">co-FR</option>
                                    <option value="co">co</option>
                                    <option value="cs-CZ">cs-CZ</option>
                                    <option value="cs">cs</option>
                                    <option value="cy-GB">cy-GB</option>
                                    <option value="cy">cy</option>
                                    <option value="da-DK">da-DK</option>
                                    <option value="da">da</option>
                                    <option value="de-AT">de-AT</option>
                                    <option value="de-CH">de-CH</option>
                                    <option value="de-DE">de-DE</option>
                                    <option value="de-LI">de-LI</option>
                                    <option value="de-LU">de-LU</option>
                                    <option value="de">de</option>
                                    <option value="dsb-DE">dsb-DE</option>
                                    <option value="dsb">dsb</option>
                                    <option value="dv-MV">dv-MV</option>
                                    <option value="dv">dv</option>
                                    <option value="el-GR">el-GR</option>
                                    <option value="el">el</option>
                                    <option value="en-029">en-029</option>
                                    <option value="en-AU">en-AU</option>
                                    <option value="en-BZ">en-BZ</option>
                                    <option value="en-CA">en-CA</option>
                                    <option value="en-GB">en-GB</option>
                                    <option value="en-HK">en-HK</option>
                                    <option value="en-IE">en-IE</option>
                                    <option value="en-IN">en-IN</option>
                                    <option value="en-JM">en-JM</option>
                                    <option value="en-MY">en-MY</option>
                                    <option value="en-NZ">en-NZ</option>
                                    <option value="en-PH">en-PH</option>
                                    <option value="en-SG">en-SG</option>
                                    <option value="en-TT">en-TT</option>
                                    <option value="en-US">en-US</option>
                                    <option value="en-ZA">en-ZA</option>
                                    <option value="en-ZW">en-ZW</option>
                                    <option value="en">en</option>
                                    <option value="es-419">es-419</option>
                                    <option value="es-AR">es-AR</option>
                                    <option value="es-BO">es-BO</option>
                                    <option value="es-CL">es-CL</option>
                                    <option value="es-CO">es-CO</option>
                                    <option value="es-CR">es-CR</option>
                                    <option value="es-DO">es-DO</option>
                                    <option value="es-EC">es-EC</option>
                                    <option value="es-ES">es-ES</option>
                                    <option value="es-GT">es-GT</option>
                                    <option value="es-HN">es-HN</option>
                                    <option value="es-MX">es-MX</option>
                                    <option value="es-NI">es-NI</option>
                                    <option value="es-PA">es-PA</option>
                                    <option value="es-PE">es-PE</option>
                                    <option value="es-PR">es-PR</option>
                                    <option value="es-PY">es-PY</option>
                                    <option value="es-SV">es-SV</option>
                                    <option value="es-US">es-US</option>
                                    <option value="es-UY">es-UY</option>
                                    <option value="es-VE">es-VE</option>
                                    <option value="es">es</option>
                                    <option value="et-EE">et-EE</option>
                                    <option value="et">et</option>
                                    <option value="eu-ES">eu-ES</option>
                                    <option value="eu">eu</option>
                                    <option value="fa-IR">fa-IR</option>
                                    <option value="fa">fa</option>
                                    <option value="ff-Latn-SN">ff-Latn-SN</option>
                                    <option value="ff-Latn">ff-Latn</option>
                                    <option value="ff">ff</option>
                                    <option value="fi-FI">fi-FI</option>
                                    <option value="fi">fi</option>
                                    <option value="fil-PH">fil-PH</option>
                                    <option value="fil">fil</option>
                                    <option value="fo-FO">fo-FO</option>
                                    <option value="fo">fo</option>
                                    <option value="fr-BE">fr-BE</option>
                                    <option value="fr-CA">fr-CA</option>
                                    <option value="fr-CD">fr-CD</option>
                                    <option value="fr-CH">fr-CH</option>
                                    <option value="fr-CI">fr-CI</option>
                                    <option value="fr-CM">fr-CM</option>
                                    <option value="fr-FR">fr-FR</option>
                                    <option value="fr-HT">fr-HT</option>
                                    <option value="fr-LU">fr-LU</option>
                                    <option value="fr-MA">fr-MA</option>
                                    <option value="fr-MC">fr-MC</option>
                                    <option value="fr-ML">fr-ML</option>
                                    <option value="fr-RE">fr-RE</option>
                                    <option value="fr-SN">fr-SN</option>
                                    <option value="fr">fr</option>
                                    <option value="fy-NL">fy-NL</option>
                                    <option value="fy">fy</option>
                                    <option value="ga-IE">ga-IE</option>
                                    <option value="ga">ga</option>
                                    <option value="gd-GB">gd-GB</option>
                                    <option value="gd">gd</option>
                                    <option value="gl-ES">gl-ES</option>
                                    <option value="gl">gl</option>
                                    <option value="gn-PY">gn-PY</option>
                                    <option value="gn">gn</option>
                                    <option value="gsw-FR">gsw-FR</option>
                                    <option value="gsw">gsw</option>
                                    <option value="gu-IN">gu-IN</option>
                                    <option value="gu">gu</option>
                                    <option value="ha-Latn-NG">ha-Latn-NG</option>
                                    <option value="ha-Latn">ha-Latn</option>
                                    <option value="ha">ha</option><option value="haw-US">haw-US</option>
                                    <option value="haw">haw</option>
                                    <option value="he-IL">he-IL</option>
                                    <option value="he">he</option>
                                    <option value="hi-IN">hi-IN</option>
                                    <option value="hi">hi</option>
                                    <option value="hr-BA">hr-BA</option>
                                    <option value="hr-HR">hr-HR</option>
                                    <option value="hr">hr</option>
                                    <option value="hsb-DE">hsb-DE</option>
                                    <option value="hsb">hsb</option>
                                    <option value="hu-HU">hu-HU</option>
                                    <option value="hu">hu</option>
                                    <option value="hy-AM">hy-AM</option>
                                    <option value="hy">hy</option>
                                    <option value="id-ID">id-ID</option>
                                    <option value="id">id</option>
                                    <option value="ig-NG">ig-NG</option>
                                    <option value="ig">ig</option>
                                    <option value="ii-CN">ii-CN</option>
                                    <option value="ii">ii</option>
                                    <option value="is-IS">is-IS</option>
                                    <option value="is">is</option>
                                    <option value="it-CH">it-CH</option>
                                    <option value="it-IT">it-IT</option>
                                    <option value="it">it</option>
                                    <option value="iu-Cans-CA">iu-Cans-CA</option>
                                    <option value="iu-Cans">iu-Cans</option>
                                    <option value="iu-Latn-CA">iu-Latn-CA</option>
                                    <option value="iu-Latn">iu-Latn</option>
                                    <option value="iu">iu</option>
                                    <option value="ja-JP">ja-JP</option>
                                    <option value="ja">ja</option>
                                    <option value="jv-Latn-ID">jv-Latn-ID</option>
                                    <option value="jv-Latn">jv-Latn</option>
                                    <option value="jv">jv</option>
                                    <option value="ka-GE">ka-GE</option>
                                    <option value="ka">ka</option>
                                    <option value="kk-KZ">kk-KZ</option>
                                    <option value="kk">kk</option>
                                    <option value="kl-GL">kl-GL</option>
                                    <option value="kl">kl</option>
                                    <option value="km-KH">km-KH</option>
                                    <option value="km">km</option>
                                    <option value="kn-IN">kn-IN</option>
                                    <option value="kn">kn</option>
                                    <option value="ko-KR">ko-KR</option>
                                    <option value="ko">ko</option>
                                    <option value="kok-IN">kok-IN</option>
                                    <option value="kok">kok</option>
                                    <option value="ku-Arab-IQ">ku-Arab-IQ</option>
                                    <option value="ku-Arab">ku-Arab</option>
                                    <option value="ku">ku</option>
                                    <option value="ky-KG">ky-KG</option>
                                    <option value="ky">ky</option>
                                    <option value="lb-LU">lb-LU</option>
                                    <option value="lb">lb</option>
                                    <option value="lo-LA">lo-LA</option>
                                    <option value="lo">lo</option>
                                    <option value="lt-LT">lt-LT</option>
                                    <option value="lt">lt</option>
                                    <option value="lv-LV">lv-LV</option>
                                    <option value="lv">lv</option>
                                    <option value="mg-MG">mg-MG</option>
                                    <option value="mg">mg</option>
                                    <option value="mi-NZ">mi-NZ</option>
                                    <option value="mi">mi</option>
                                    <option value="mk-MK">mk-MK</option>
                                    <option value="mk">mk</option>
                                    <option value="ml-IN">ml-IN</option>
                                    <option value="ml">ml</option>
                                    <option value="mn-Cyrl">mn-Cyrl</option>
                                    <option value="mn-MN">mn-MN</option>
                                    <option value="mn-Mong-CN">mn-Mong-CN</option>
                                    <option value="mn-Mong-MN">mn-Mong-MN</option>
                                    <option value="mn-Mong">mn-Mong</option>
                                    <option value="mn">mn</option>
                                    <option value="moh-CA">moh-CA</option>
                                    <option value="moh">moh</option>
                                    <option value="mr-IN">mr-IN</option>
                                    <option value="mr">mr</option>
                                    <option value="ms-BN">ms-BN</option>
                                    <option value="ms-MY">ms-MY</option>
                                    <option value="ms">ms</option>
                                    <option value="mt-MT">mt-MT</option>
                                    <option value="mt">mt</option>
                                    <option value="my-MM">my-MM</option>
                                    <option value="my">my</option>
                                    <option value="nb-NO">nb-NO</option>
                                    <option value="nb">nb</option>
                                    <option value="ne-IN">ne-IN</option>
                                    <option value="ne-NP">ne-NP</option>
                                    <option value="ne">ne</option>
                                    <option value="nl-BE">nl-BE</option>
                                    <option value="nl-NL">nl-NL</option>
                                    <option value="nl">nl</option>
                                    <option value="nn-NO">nn-NO</option>
                                    <option value="nn">nn</option>
                                    <option value="no">no</option>
                                    <option value="nqo-GN">nqo-GN</option>
                                    <option value="nqo">nqo</option>
                                    <option value="nso-ZA">nso-ZA</option>
                                    <option value="nso">nso</option>
                                    <option value="oc-FR">oc-FR</option>
                                    <option value="oc">oc</option>
                                    <option value="om-ET">om-ET</option>
                                    <option value="om">om</option>
                                    <option value="or-IN">or-IN</option>
                                    <option value="or">or</option>
                                    <option value="pa-Arab-PK">pa-Arab-PK</option>
                                    <option value="pa-Arab">pa-Arab</option>
                                    <option value="pa-IN">pa-IN</option>
                                    <option value="pa">pa</option>
                                    <option value="pl-PL">pl-PL</option>
                                    <option value="pl">pl</option>
                                    <option value="prs-AF">prs-AF</option>
                                    <option value="prs">prs</option>
                                    <option value="ps-AF">ps-AF</option>
                                    <option value="ps">ps</option>
                                    <option value="pt-AO">pt-AO</option>
                                    <option value="pt-BR">pt-BR</option>
                                    <option value="pt-PT">pt-PT</option>
                                    <option value="pt">pt</option>
                                    <option value="qut-GT">qut-GT</option>
                                    <option value="qut">qut</option>
                                    <option value="quz-BO">quz-BO</option>
                                    <option value="quz-EC">quz-EC</option>
                                    <option value="quz-PE">quz-PE</option>
                                    <option value="quz">quz</option>
                                    <option value="rm-CH">rm-CH</option>
                                    <option value="rm">rm</option>
                                    <option value="ro-MD">ro-MD</option>
                                    <option value="ro-RO">ro-RO</option>
                                    <option value="ro">ro</option>
                                    <option value="ru-RU">ru-RU</option>
                                    <option value="ru-UA">ru-UA</option>
                                    <option value="ru">ru</option>
                                    <option value="rw-RW">rw-RW</option>
                                    <option value="rw">rw</option>
                                    <option value="sa-IN">sa-IN</option>
                                    <option value="sa">sa</option>
                                    <option value="sah-RU">sah-RU</option>
                                    <option value="sah">sah</option>
                                    <option value="sd-Arab-PK">sd-Arab-PK</option>
                                    <option value="sd-Arab">sd-Arab</option>
                                    <option value="sd">sd</option>
                                    <option value="se-FI">se-FI</option>
                                    <option value="se-NO">se-NO</option>
                                    <option value="se-SE">se-SE</option>
                                    <option value="se">se</option>
                                    <option value="si-LK">si-LK</option>
                                    <option value="si">si</option>
                                    <option value="sk-SK">sk-SK</option>
                                    <option value="sk">sk</option>
                                    <option value="sl-SI">sl-SI</option>
                                    <option value="sl">sl</option>
                                    <option value="sma-NO">sma-NO</option>
                                    <option value="sma-SE">sma-SE</option>
                                    <option value="sma">sma</option>
                                    <option value="smj-NO">smj-NO</option>
                                    <option value="smj-SE">smj-SE</option>
                                    <option value="smj">smj</option>
                                    <option value="smn-FI">smn-FI</option>
                                    <option value="smn">smn</option>
                                    <option value="sms-FI">sms-FI</option>
                                    <option value="sms">sms</option>
                                    <option value="sn-Latn-ZW">sn-Latn-ZW</option>
                                    <option value="sn-Latn">sn-Latn</option>
                                    <option value="sn">sn</option>
                                    <option value="so-SO">so-SO</option>
                                    <option value="so">so</option>
                                    <option value="sq-AL">sq-AL</option>
                                    <option value="sq">sq</option>
                                    <option value="sr-Cyrl-BA">sr-Cyrl-BA</option>
                                    <option value="sr-Cyrl-CS">sr-Cyrl-CS</option>
                                    <option value="sr-Cyrl-ME">sr-Cyrl-ME</option>
                                    <option value="sr-Cyrl-RS">sr-Cyrl-RS</option>
                                    <option value="sr-Cyrl">sr-Cyrl</option>
                                    <option value="sr-Latn-BA">sr-Latn-BA</option>
                                    <option value="sr-Latn-CS">sr-Latn-CS</option>
                                    <option value="sr-Latn-ME">sr-Latn-ME</option>
                                    <option value="sr-Latn-RS">sr-Latn-RS</option>
                                    <option value="sr-Latn">sr-Latn</option>
                                    <option value="sr">sr</option>
                                    <option value="st-ZA">st-ZA</option>
                                    <option value="st">st</option>
                                    <option value="sv-FI">sv-FI</option>
                                    <option value="sv-SE">sv-SE</option>
                                    <option value="sv">sv</option>
                                    <option value="sw-KE">sw-KE</option>
                                    <option value="sw">sw</option>
                                    <option value="syr-SY">syr-SY</option>
                                    <option value="syr">syr</option>
                                    <option value="ta-IN">ta-IN</option>
                                    <option value="ta-LK">ta-LK</option>
                                    <option value="ta">ta</option>
                                    <option value="te-IN">te-IN</option>
                                    <option value="te">te</option>
                                    <option value="tg-Cyrl-TJ">tg-Cyrl-TJ</option>
                                    <option value="tg-Cyrl">tg-Cyrl</option>
                                    <option value="tg">tg</option>
                                    <option value="th-TH">th-TH</option>
                                    <option value="th">th</option>
                                    <option value="ti-ER">ti-ER</option>
                                    <option value="ti-ET">ti-ET</option>
                                    <option value="ti">ti</option>
                                    <option value="tk-TM">tk-TM</option>
                                    <option value="tk">tk</option>
                                    <option value="tn-BW">tn-BW</option>
                                    <option value="tn-ZA">tn-ZA</option>
                                    <option value="tn">tn</option>
                                    <option value="tr-TR">tr-TR</option>
                                    <option value="tr">tr</option>
                                    <option value="ts-ZA">ts-ZA</option>
                                    <option value="ts">ts</option>
                                    <option value="tt-RU">tt-RU</option>
                                    <option value="tt">tt</option>
                                    <option value="tzm-Latn-DZ">tzm-Latn-DZ</option>
                                    <option value="tzm-Latn">tzm-Latn</option>
                                    <option value="tzm-Tfng-MA">tzm-Tfng-MA</option>
                                    <option value="tzm-Tfng">tzm-Tfng</option>
                                    <option value="tzm">tzm</option>
                                    <option value="ug-CN">ug-CN</option>
                                    <option value="ug">ug</option>
                                    <option value="uk-UA">uk-UA</option>
                                    <option value="uk">uk</option>
                                    <option value="ur-IN">ur-IN</option>
                                    <option value="ur-PK">ur-PK</option>
                                    <option value="ur">ur</option>
                                    <option value="uz-Cyrl-UZ">uz-Cyrl-UZ</option>
                                    <option value="uz-Cyrl">uz-Cyrl</option>
                                    <option value="uz-Latn-UZ">uz-Latn-UZ</option>
                                    <option value="uz-Latn">uz-Latn</option>
                                    <option value="uz">uz</option>
                                    <option value="vi-VN">vi-VN</option>
                                    <option value="vi">vi</option>
                                    <option value="wo-SN">wo-SN</option>
                                    <option value="wo">wo</option>
                                    <option value="xh-ZA">xh-ZA</option>
                                    <option value="xh">xh</option>
                                    <option value="yo-NG">yo-NG</option>
                                    <option value="yo">yo</option>
                                    <option value="zgh-Tfng-MA">zgh-Tfng-MA</option>
                                    <option value="zgh-Tfng">zgh-Tfng</option>
                                    <option value="zgh">zgh</option>
                                    <option value="zh-CHS">zh-CHS</option>
                                    <option value="zh-CHT">zh-CHT</option>
                                    <option value="zh-CN">zh-CN</option>
                                    <option value="zh-HK">zh-HK</option>
                                    <option value="zh-Hans">zh-Hans</option>
                                    <option value="zh-Hant">zh-Hant</option>
                                    <option value="zh-MO">zh-MO</option>
                                    <option value="zh-SG">zh-SG</option>
                                    <option value="zh-TW">zh-TW</option>
                                    <option value="zh">zh</option>
                                    <option value="zu-ZA">zu-ZA</option>
                                    <option value="zu">zu</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>Theme</th>
                        </tr>
                        <tr>
                            <td>
                                <span id="themeChooser" style="" data-role="themechooser" class="k-theme-chooser">
                                    <span class="tc-choose-theme">Choose theme:</span>
                                    <a class="tc-link k-state-selected" href="#">
                                        <span class="tc-theme-name">Blue Opal</span>
                                        <span class="k-icon k-i-arrow-s"></span>
                                    </a></span>
                                <div id="theme-list-container"></div>
                            </td>
                        </tr>
                        <tr>
                            <th>Background Color</th>
                        </tr>
                        <tr>
                            <td>
                                <input id="kendo-background-color" style="width: 100px !important; display: none;">
                            </td>
                        </tr>
                        <tr>
                            <th>Wallpaper</th>
                        </tr>
                        <tr>
                            <td>
                                <div id="theme-background-container">
                                    <span class="tc-choose-wallpaper">Choose a wallpaper:</span> 
                                    <select id="theme-background"></select>
                                </div>
                                <div id='upload-wallpaper'>
                                    <input type="file" name='file'>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>Save Windows State</th>
                        </tr>
                        <tr>
                            <td><input type="checkbox" id="save-state"></td>
                        </tr>
                    </tbody></table>
                <button id="clear-storage" class="k-button">Clear storage</button>
            </div>
            <div>
                <div class="k-pane k-block">
                    Change your password
                </div>
                <form id="change-password">
                    <table class="tableEdit">
                        <tbody><tr>
                                <th>Current Password</th>
                            </tr>
                            <tr>
                                <td>
                                    <input class="k-textbox" type="password" name="current" required="">
                                </td>
                            </tr>
                            <tr>
                                <th>New Password</th>
                            </tr>
                            <tr>
                                <td>
                                    <input class="k-textbox" type="password" name="new" required="">
                                </td>
                            </tr>
                            <tr>
                                <th>Re-type new Password</th>
                            </tr>
                            <tr>
                                <td>
                                    <input class="k-textbox" type="password" name="new2" required="">
                                </td>
                            </tr>
                        </tbody></table>
                    <button class="k-button">Change password</button>
                </form>
            </div>
        </div>
    </div>
</div>
<script id="script-settings">
    app().controllers.settings.run = function () {

        var $ctrl = this;
        $ctrl.name = "settings";

        $ctrl.window = $("#window-settings").kendoWindow({
            actions: ["note", "Maximize", "Minimize", "Close"],
            height: "600px",
            width: "800px",
            title: "Edit settings",
            visible: false,
            resize: app().ui.state.windowResize,
            dragend: app().ui.state.windowMove,
            close: app().ui.state.windowClose,
            open: app().ui.state.windowOpen,
            controllerName: $ctrl.name
        }).data("kendoWindow");

        $("#kendo-background-color", $ctrl.window.element).kendoColorPicker({
            value: app().ui.backgroundColor,
            buttons: true,
            change: function (e) {
                var selected = e.value;
                app().ui.changeBackgroundColor(selected);
            }
        });

        $("#themeChooser", $ctrl.window.element).kendoThemeChooser();

        $("#kendo-culture", $ctrl.window.element).kendoDropDownList({
            change: function () {
                var selected = this.dataItem().value;
                app().ui.changeCulture(selected, function() {
                    if (!confirm("Culture changed to " + selected + "\nDo you wanto to reload the interface ?")) {
                        kendo.ui.progress($("body"), false);
                        return;
                    }
                    window.location = '/admin';
                });
                kendo.ui.progress($("body"), true);
            }
        });
        $("#kendo-culture", $ctrl.window.element).data("kendoDropDownList").value(app().ui.culture);

        $("#kendo-language", $ctrl.window.element).kendoDropDownList({
            change: function () {
                var selected = this.dataItem().value;
                app().ui.changeLanguage(selected, function() {
                    if (!confirm("Language changed to " + selected + "\nDo you wanto to reload the interface ?")) {
                        kendo.ui.progress($("body"), false);
                        return;
                    }
                    window.location = '/admin';
                });
                kendo.ui.progress($("body"), true);
            }
        });
        $("#kendo-language", $ctrl.window.element).data("kendoDropDownList").value(app().ui.language);
        app().ui.changeLanguage($("#kendo-language", $ctrl.window.element).data("kendoDropDownList").value());

        var upload = function (files) {
            return $("#upload-wallpaper input[name=file]", $ctrl.window.element).kendoUpload({
                async: {
                    saveUrl: app().service.url + "/admin/settings/upload",
                    removeUrl: app().service.url + "/admin/settings/remove",
                    autoUpload: true
                },
                files: files || [],
                remove: function (e) {
                    var fileUidToRemove = e.files[0].uid;
                    e.preventDefault();
                    if (confirm("Remove the file?")) {
                        fileUpload.removeFileByUid(fileUidToRemove);
                    }
                },
                success: function (e) {
                    $("#theme-background", $ctrl.window.element).data("kendoDropDownList").dataSource.read();
                }
            }).data("kendoUpload");
        };
        var fileUpload;

        var bg = $("#theme-background", $ctrl.window.element).kendoDropDownList({
            dataSource: {
                transport: {
                    read: {
                        url: app().service.url + "/admin/settings/wallpapers"
                    }
                },
                requestEnd: function (e) {
                    bg.value(app().ui.wallpaper);
                    bg.trigger("change");
                }
            },
            change: function (e) {
                var selected = this.value();
                app().ui.changeWallpaper(selected);
                if (fileUpload) {
                    fileUpload.clearAllFiles();
                    fileUpload.destroy();
                    $("#upload-wallpaper", $ctrl.window.element).html("<input type=file name=file>");
                }
                var files = selected ? [{name: selected, extension: selected.split(".").pop(), size: 0}] : [];
                fileUpload = upload(files);
            }
        }).data("kendoDropDownList");

        var ss = false;
        if (app().storage.getItem)
            ss = app().storage.getItem('savestate');

        if (ss > 0)
            $("#save-state", $ctrl.window.element).attr("checked", "checked");

        $("#save-state", $ctrl.window.element).click(function () {
            app().storage.setItem("savestate", this.checked ? 1 : 0);
        });

        $("#clear-storage", $ctrl.window.element).click(function () {
            if (!confirm("Do you really want to clear all user preferences stored ?"))
                return;
            app().storage.clear();
        });

        app().tabstrip(".tabstrip", $ctrl.window.element);
        $("#change-password").on("submit", function (e) {
            e.preventDefault();
            var currentPass = $("[name=current]", $ctrl.window.element).val();
            var newPass = $("[name=new]", $ctrl.window.element).val();
            var newPassRetyped = $("[name=new2]", $ctrl.window.element).val();

            if (newPass !== newPassRetyped) {
                alert("Password mismatch");
                $("[name=new]", $ctrl.window.element).facus();
                return false;
            }

            $.ajax({
                url: app().service.url + "/admin/settings/check-password",
                type: "POST",
                data: {password: currentPass},
                dataType: app().dataType,
                success: function (data) {
                    if (data.check) {
                        $.ajax({
                            url: app().service.url + "/admin/settings/change-password",
                            type: "POST",
                            data: {password: newPass},
                            dataType: app().dataType,
                            success: function (data) {
                                alert("Password changed");
                                return false;
                            }
                        });
                    } else {
                        alert("Invalid current password");
                        return false;
                    }
                }
            });
            return false;
        });

        $ctrl.window.center();
    };
</script>